<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Tracking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            "50": "#eff6ff",
                            "100": "#dbeafe",
                            "200": "#bfdbfe",
                            "300": "#93c5fd",
                            "400": "#60a5fa",
                            "500": "#3b82f6",
                            "600": "#2563eb",
                            "700": "#1d4ed8",
                            "800": "#1e40af",
                            "900": "#1e3a8a",
                            "950": "#172554"
                        }
                    },
                    keyframes: {
                        'fade-in-out': {
                            '0%': { opacity: 0 },
                            '10%': { opacity: 1 },
                            '90%': { opacity: 1 },
                            '100%': { opacity: 0 }
                        }
                    },
                    animation: {
                        'fade-in-out': 'fade-in-out 3s ease-in-out forwards'
                    }
                }
            }
        }
    </script>
    <style>
        .edit-only-field {
            display: none;
        }
        
        .edit-mode .edit-only-field {
            display: block;
        }

        .edit-mode input[type="text"],
        .edit-mode input[type="date"],
        .edit-mode select,
        .edit-mode textarea {
            background-color: white !important;
            cursor: text !important;
        }
    </style>
</head>

<body>
    <section class="bg-gray-50 p-3 sm:p-5">
        <div class="mx-auto max-w-screen-3xl px-4 lg:px-12">
            <!-- Start coding here -->
            <div class="bg-white relative shadow-md sm:rounded-lg overflow-visible">
                <div
                    class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4">
                    <div class="w-full md:w-2/3">
                        <div class="flex items-center space-x-3">
                        <form class="flex-1">
                            <label for="simple-search" class="sr-only">Search</label>
                            <div class="relative w-full">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5 text-gray-500" fill="currentColor"
                                        viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <input type="text" id="simple-search"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-md rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2"
                                    placeholder="Search" required="">
                            </div>
                        </form>
                        <button type="button" id="refreshTableBtn"
                            class="flex items-center justify-center py-2 px-4 text-md font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Refresh
                        </button>
                        <button type="button" id="clearFiltersBtn"
                            class="flex items-center justify-center py-2 px-4 text-md font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            Clear Filters
                        </button>
                        <div class="relative">
                            <button id="filterDropdownButton" data-dropdown-toggle="filterDropdown"
                                class="flex items-center justify-center py-2 px-4 text-md font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200"
                                type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
                                    class="h-4 w-4 mr-2 text-gray-400" viewbox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                                        clip-rule="evenodd" />
                                </svg>
                                Filter
                                <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd"
                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                </svg>
                            </button>
                                <div id="filterDropdown" class="z-50 hidden w-96 p-3 bg-white rounded-lg shadow absolute mt-1 max-h-[500px] overflow-y-auto border-2 border-gray-200">
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Region</h6>
                                            <ul class="space-y-2 text-md">
                                                <li class="flex items-center">
                                                    <input id="filterGlobal" type="checkbox" value="Global"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterGlobal"
                                                        class="ml-2 text-md font-medium text-blue-800 bg-blue-100 px-2 py-0.5 rounded">Global</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterEMEA" type="checkbox" value="EMEA"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterEMEA"
                                                        class="ml-2 text-md font-medium text-purple-800 bg-purple-100 px-2 py-0.5 rounded">EMEA</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterAPAC" type="checkbox" value="APAC"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterAPAC"
                                                        class="ml-2 text-md font-medium text-green-800 bg-green-100 px-2 py-0.5 rounded">APAC</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterNAM" type="checkbox" value="NAM"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterNAM"
                                                        class="ml-2 text-md font-medium text-orange-800 bg-orange-100 px-2 py-0.5 rounded">NAM</label>
                                                </li>
                                            </ul>
                                        </div>
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Status</h6>
                                            <ul class="space-y-2 text-md">
                                                <li class="flex items-center">
                                                    <input id="filterPending" type="checkbox" value="Pending"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterPending"
                                                        class="ml-2 text-md font-medium text-yellow-800 bg-yellow-100 px-2 py-0.5 rounded">Pending</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterOnTime" type="checkbox" value="On Time"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterOnTime"
                                                        class="ml-2 text-md font-medium text-green-800 bg-green-100 px-2 py-0.5 rounded">On Time</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterLate" type="checkbox" value="Late"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterLate"
                                                        class="ml-2 text-md font-medium text-red-800 bg-red-100 px-2 py-0.5 rounded">Late</label>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Maker</h6>
                                            <div class="relative">
                                                <select id="filterMaker" multiple
                                                    class="w-full px-2 py-1 text-md border border-gray-300 rounded focus:ring-primary-500 focus:border-primary-500 appearance-none">
                                                    <option value="John Smith">John Smith</option>
                                                    <option value="Sarah Johnson">Sarah Johnson</option>
                                                    <option value="David Lee">David Lee</option>
                                                    <option value="Emily Wilson">Emily Wilson</option>
                                                    <option value="Lisa Zhang">Lisa Zhang</option>
                                                </select>
                                            </div>
                                            <div id="selectedMakers" class="flex flex-wrap gap-1 mt-1"></div>
                                        </div>
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Checker</h6>
                                            <div class="relative">
                                                <select id="filterChecker" multiple
                                                    class="w-full px-2 py-1 text-md border border-gray-300 rounded focus:ring-primary-500 focus:border-primary-500 appearance-none">
                                                    <option value="Maria Garcia">Maria Garcia</option>
                                                    <option value="Robert Chen">Robert Chen</option>
                                                    <option value="Michael Brown">Michael Brown</option>
                                                    <option value="Thomas Rodriguez">Thomas Rodriguez</option>
                                                </select>
                                            </div>
                                            <div id="selectedCheckers" class="flex flex-wrap gap-1 mt-1"></div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Upcoming Deadlines (Days)</h6>
                                            <input type="number" id="filterDays" min="1" max="30"
                                                class="w-full px-2 py-1 text-md border border-gray-300 rounded focus:ring-primary-500 focus:border-primary-500"
                                                placeholder="Enter number of days">
                                        </div>
                                        <div>
                                            <h6 class="mb-2 text-md font-medium text-gray-900">Severity</h6>
                                            <ul class="space-y-2 text-md">
                                                <li class="flex items-center">
                                                    <input id="filterCritical" type="checkbox" value="Critical"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterCritical"
                                                        class="ml-2 text-md font-medium text-amber-800 bg-amber-100 px-2 py-0.5 rounded">Critical</label>
                                                </li>
                                                <li class="flex items-center">
                                                    <input id="filterNonCritical" type="checkbox" value="Non-Critical"
                                                        class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500">
                                                    <label for="filterNonCritical"
                                                        class="ml-2 text-md font-medium text-purple-800 bg-purple-100 px-2 py-0.5 rounded">Non-Critical</label>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button type="button" id="addReportBtn"
                            class="flex items-center justify-center text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-md px-4 py-2">
                            <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path clip-rule="evenodd" fill-rule="evenodd"
                                    d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                            </svg>
                            Add Report
                        </button>
                        <button type="button" id="bulkRelogBtn"
                            class="flex items-center justify-center text-white bg-amber-600 hover:bg-amber-700 focus:ring-4 focus:ring-amber-300 font-medium rounded-lg text-md px-4 py-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                            </svg>
                            Relog
                        </button>
                        <button type="button"
                            class="flex items-center justify-center flex-shrink-0 px-3 py-2 text-md font-medium text-gray-900 bg-white border border-gray-200 rounded-lg focus:outline-none hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200">
                            <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24"
                                stroke-width="2" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-4 p-4">
                    <div class="flex items-center">
                        <input id="filterAll" type="radio" name="statusFilter" value="all" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500">
                        <label for="filterAll" class="ml-2 text-md font-medium text-gray-900">Show All</label>
                    </div>
                    <div class="flex items-center">
                        <input id="filterSubmitted" type="radio" name="statusFilter" value="submitted" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500">
                        <label for="filterSubmitted" class="ml-2 text-md font-medium text-gray-900">Submitted</label>
                    </div>
                    <div class="flex items-center">
                        <input id="filterOpen" type="radio" name="statusFilter" value="open" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500" checked>
                        <label for="filterOpen" class="ml-2 text-md font-medium text-gray-900">Open</label>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-md text-left text-gray-500">
                        <thead class="text-md text-gray-700 bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">
                                    <div class="flex items-center">
                                        <input id="selectAll" type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500">
                                    </div>
                                </th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">
                                    Actions
                                </th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Report</th>
                                <th scope="col" class="px-4 py-3 text-left">Coverage</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Time Period</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Severity</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Region</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Freq.</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Status</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Due</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Upcoming Deadlines</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Submitted</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Send Date</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">On Drive</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Delegate</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Maker</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Maker Notes</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Checker</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Checker Note</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">Delay Notified</th>
                                <th scope="col" class="px-4 py-3 text-left whitespace-nowrap">MCA</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Table rows will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
                <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4" aria-label="Table navigation">
                    <div class="flex items-center justify-between w-full">
                        <div class="flex flex-col gap-4">
                            <div class="flex items-center gap-4">
                                <button class="pagination-prev text-theme-sm shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-800 sm:px-3.5">
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z" fill=""></path>
                                    </svg>
                                    <span>Previous</span>
                                </button>
                            </div>
                        </div>

                        <div class="flex-1 flex justify-center">
                            <ul class="flex items-center gap-0.5 pagination-buttons">
                                <!-- Page numbers will be dynamically added here -->
                            </ul>
                        </div>

                        <button class="pagination-next text-theme-sm shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-800 sm:px-3.5">
                            <span>Next</span>
                            <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z" fill=""></path>
                            </svg>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
    </section>
    <!-- Edit/Add Report Modal -->
    <div id="editReportModal" class="fixed hidden inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center">
        <div class="no-scrollbar relative w-full max-w-[700px] overflow-y-auto rounded-3xl bg-white p-6 lg:p-11">
            <div class="px-2">
                <h4 class="mb-2 text-2xl font-semibold text-gray-800" id="modal-title">
                    Add Report
                </h4>
                <p class="mb-6 text-sm text-gray-500 lg:mb-7" id="modal-subtitle">
                    Create a new report entry with all required details
                </p>
            </div>

            <!-- close btn -->
            <button id="closeModal" class="transition-color absolute right-5 top-5 z-999 flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 hover:text-gray-600 sm:h-11 sm:w-11">
                <svg class="fill-current size-5 sm:size-6" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z" fill=""></path>
                </svg>
            </button>

            <form id="reportForm" class="flex flex-col">
                <input type="hidden" id="reportId" name="reportId" />
                <div class="custom-scrollbar h-[450px] overflow-y-auto px-2">
                    <div class="grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2">
                        <div class="sm:col-span-2">
                            <label for="reportName" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Report Name
                            </label>
                            <input type="text" id="reportName" name="reportName" readonly class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-100 px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs cursor-not-allowed">
                        </div>

                        <div class="sm:col-span-2">
                            <label for="coverage" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Coverage
                            </label>
                            <input type="text" id="coverage" name="coverage" readonly class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-100 px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs cursor-not-allowed">
                        </div>

                        <div>
                            <label for="severity" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Severity
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="severity" name="severity" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="Critical">Critical</option>
                                    <option value="Non-Critical">Non-Critical</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div>
                            <label for="region" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Region
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="region" name="region" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="Global">Global</option>
                                    <option value="EMEA">EMEA</option>
                                    <option value="APAC">APAC</option>
                                    <option value="NAM">NAM</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div>
                            <label for="frequency" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Frequency
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="frequency" name="frequency" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="Weekly">Weekly</option>
                                    <option value="Semi-Monthly">Semi-Monthly</option>
                                    <option value="Monthly">Monthly</option>
                                    <option value="Quarterly">Quarterly</option>
                                    <option value="Month-end">Month-end</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div>
                            <label for="dueDate" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Due Date
                            </label>
                            <div class="relative">
                                <input type="date" id="dueDate" name="dueDate" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                            </div>
                        </div>

                        <div class="edit-only-field">
                            <label for="submittedDate" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Submitted Date
                            </label>
                            <div class="relative">
                                <input type="date" id="submittedDate" name="submittedDate" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                            </div>
                        </div>

                        <div class="edit-only-field">
                            <label for="sendDate" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Send Date
                            </label>
                            <div class="relative">
                                <input type="date" id="sendDate" name="sendDate" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                            </div>
                        </div>

                        <div class="edit-only-field">
                            <label for="onDrive" class="mb-1.5 block text-sm font-medium text-gray-700">
                                On Drive
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="onDrive" name="onDrive" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div class="edit-only-field">
                            <label for="delegate" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Delegate
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="delegate" name="delegate" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="">-- Select Delegate --</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div>
                            <label for="maker" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Maker
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="maker" name="maker" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="">-- Select Maker --</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div class="sm:col-span-2">
                            <label for="makerNotes" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Maker Notes
                            </label>
                            <textarea id="makerNotes" name="makerNotes" rows="3" class="w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10"></textarea>
                        </div>

                        <div>
                            <label for="checker" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Checker
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="checker" name="checker" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="">-- Select Checker --</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <div class="sm:col-span-2">
                            <label for="checkerNote" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Checker Notes
                            </label>
                            <textarea id="checkerNote" name="checkerNote" rows="3" class="w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10"></textarea>
                        </div>

                        <div class="edit-only-field">
                            <label for="delayNotified" class="mb-1.5 block text-sm font-medium text-gray-700">
                                Delay Notified
                            </label>
                            <div class="relative z-20 bg-transparent">
                                <select id="delayNotified" name="delayNotified" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                    <option value="N/A">N/A</option>
                                </select>
                                <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                    <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col items-center gap-6 px-2 mt-6 sm:flex-row sm:justify-between">
                    <div class="flex items-center w-full gap-3 sm:w-auto">
                        <button type="button" id="closeModal" class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:w-auto">
                            Cancel
                        </button>
                        <button type="submit" id="saveButton" disabled class="flex w-full justify-center rounded-lg bg-primary-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-300 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed">
                            Save Report
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Relog Modal -->
    <div id="bulkRelogModal" class="fixed hidden inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center">
        <div class="no-scrollbar relative w-full max-w-[500px] overflow-y-auto rounded-3xl bg-white p-6">
            <div class="px-2">
                <h4 class="mb-2 text-2xl font-semibold text-gray-800">
                    Report Delegation
                </h4>
                <p class="mb-4 text-sm text-gray-500">
                    Select a new delegate for the selected reports
                </p>
            </div>

            <!-- close btn -->
            <button id="closeBulkRelogModal" class="transition-color absolute right-5 top-5 z-999 flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 hover:text-gray-600">
                <svg class="fill-current size-5" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z" fill=""></path>
                </svg>
            </button>

            <form id="bulkRelogForm" class="flex flex-col">
                <div class="px-2">
                    <div class="mb-6">
                        <label for="bulkNewMaker" class="mb-1.5 block text-sm font-medium text-gray-700">
                            Select Delegate
                        </label>
                        <div class="relative z-20 bg-transparent">
                            <select id="bulkNewMaker" name="bulkNewMaker" class="h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                <option value="">-- Select Delegate --</option>
                            </select>
                            <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-4 top-1/2">
                                <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col items-center gap-3 px-2 sm:flex-row sm:justify-end">
                    <button type="button" id="cancelBulkRelogModal" class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:w-auto">
                        Cancel
                    </button>
                    <button type="submit" id="saveBulkRelogButton" class="flex w-full justify-center rounded-lg bg-primary-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-300 sm:w-auto">
                        Relog
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize reports array
        let reports = [];

        // Helper function to format dates for display
        function formatDate(dateString) {
            if (!dateString) return '--';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Calculate the status based on the due and submitted dates
        function calculateStatus(dueDate, submittedDate) {
            // If submittedDate is empty, status is Pending
            if (!submittedDate) {
                return "Pending";
            }

            // Calculate the difference in days
            const dueDateTime = new Date(dueDate).getTime();
            const submittedDateTime = new Date(submittedDate).getTime();
            const diffDays = Math.floor((submittedDateTime - dueDateTime) / (1000 * 60 * 60 * 24));

            // If submitted before or on the due date, status is Submitted
            if (diffDays <= 0) {
                return "Submitted";
            }

            // Otherwise, it's Submitted with days late
            return `Submitted (+${diffDays}D Late)`;
        }

        // Calculate MCA based on status
        function calculateMCA(status) {
            if (status === "Pending") {
                return "Pending";
            } else if (status === "On Time") {
                return "Pass";
            } else {
                // If it's any form of late
                return "Fail";
            }
        }

        // Function to calculate urgency percentage and color
        function getDueDateUrgency(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // If due date is in the past, return 100% red
            if (diffDays < 0) {
                return { percentage: 100, color: 'bg-red-500' };
            }

            // Calculate percentage based on 10 days window
            const percentage = Math.min(100, Math.max(0, (10 - diffDays) / 10 * 100));

            // Determine color based on days remaining
            if (diffDays <= 3) {
                return { percentage, color: 'bg-red-500' };
            } else if (diffDays <= 7) {
                return { percentage, color: 'bg-yellow-500' };
            } else {
                return { percentage: 0, color: 'bg-emerald-500' }; // Using emerald-500 for a more visible green
            }
        }

        // Function to render the status badge with appropriate color
        function getStatusBadge(status) {
            let colorClass = 'bg-gray-100 text-gray-800';

            if (status === "Submitted") {
                colorClass = 'bg-green-100 text-green-800';
            } else if (status === "Pending") {
                colorClass = 'bg-yellow-100 text-yellow-800';
            } else if (status.includes("Late")) {
                colorClass = 'bg-red-100 text-red-800';
            }

            return `<span class="${colorClass} text-md font-medium px-2 py-0.5 rounded">${status}</span>`;
        }

        // Function to render the region badge with appropriate color
        function getRegionBadge(region) {
            let colorClass = 'bg-gray-100 text-gray-800';

            if (region === "Global") {
                colorClass = 'bg-blue-100 text-blue-800';
            } else if (region === "EMEA") {
                colorClass = 'bg-purple-100 text-purple-800';
            } else if (region === "APAC") {
                colorClass = 'bg-green-100 text-green-800';
            } else if (region === "NAM") {
                colorClass = 'bg-orange-100 text-orange-800';
            }

            return `<span class="${colorClass} text-md font-medium px-2 py-0.5 rounded">${region}</span>`;
        }

        // Function to calculate upcoming deadlines status
        function getUpcomingDeadlinesStatus(dueDate, submittedDate) {
            // If report is submitted, show Submitted status
            if (submittedDate) {
                const dueDateTime = new Date(dueDate).getTime();
                const submittedDateTime = new Date(submittedDate).getTime();
                const diffDays = Math.floor((submittedDateTime - dueDateTime) / (1000 * 60 * 60 * 24));

                // If submitted before or on due date
                if (diffDays <= 0) {
                return {
                        status: 'Submitted',
                        color: 'bg-emerald-500',
                        textColor: 'text-emerald-500',
                        percentage: 0
                    };
                }
            }

            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Calculate percentage based on 30 days window
            const percentage = Math.min(100, Math.max(0, (30 - diffDays) / 30 * 100));

            // Determine color and status based on days remaining
            if (diffDays <= 7) {
                return {
                    status: `Critical (${diffDays} day${diffDays === 1 ? '' : 's'})`,
                    color: 'bg-red-500',
                    textColor: 'text-red-500',
                    percentage
                };
            } else if (diffDays <= 14) {
                return {
                    status: `Soon (${diffDays} days)`,
                    color: 'bg-yellow-500',
                    textColor: 'text-yellow-500',
                    percentage
                };
            } else {
                return {
                    status: `Upcoming (${diffDays} days)`,
                    color: 'bg-emerald-500',
                    textColor: 'text-emerald-500',
                    percentage
                };
            }
        }

        // Function to get mapping key
        function getMappingKey(reportName, region) {
            return `${reportName}_${region}`;
        }

        // Function to load user mapping data
        async function loadUserMapping() {
            try {
                // In production, this would fetch from your API
                // const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/user-mapping.json?api=v2');
                // const userMapping = await response.json();
                
                // For now, using fallback data with role flags
                const userMapping = [
                    { userId: "BR47149", fullName: "Bob Rahmatov", maker: true, checker: true },
                    { userId: "JS12345", fullName: "John Smith", maker: true, checker: false },
                    { userId: "SJ67890", fullName: "Sarah Johnson", maker: true, checker: false },
                    { userId: "DL24680", fullName: "David Lee", maker: true, checker: false },
                    { userId: "EW13579", fullName: "Emily Wilson", maker: true, checker: false },
                    { userId: "LZ86420", fullName: "Lisa Zhang", maker: true, checker: false },
                    { userId: "MG97531", fullName: "Maria Garcia", maker: false, checker: true },
                    { userId: "RC75319", fullName: "Robert Chen", maker: false, checker: true },
                    { userId: "MB24680", fullName: "Michael Brown", maker: false, checker: true },
                    { userId: "TR13579", fullName: "Thomas Rodriguez", maker: false, checker: true }
                ];
                
                return userMapping;
            } catch (error) {
                console.error('Error loading user mapping:', error);
                showNotification('Error loading user mapping: ' + error.message, 'error');
                return [];
            }
        }

        // Function to populate dropdowns with users
        async function populateDropdowns() {
            const userMapping = await loadUserMapping();
            const makerSelect = document.getElementById('maker');
            const checkerSelect = document.getElementById('checker');
            const delegateSelect = document.getElementById('delegate');
            const bulkDelegateSelect = document.getElementById('bulkNewMaker');

            // Clear existing options
            [makerSelect, checkerSelect, delegateSelect, bulkDelegateSelect].forEach(select => {
                if (select) {
                    // Keep the first option (placeholder)
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                }
            });

            // Add user options to maker dropdown (only users with maker role)
            userMapping.filter(user => user.maker).forEach(user => {
                const option = document.createElement('option');
                option.value = user.userId;
                option.textContent = `${user.userId} - ${user.fullName}`;
                makerSelect.appendChild(option);
            });

            // Add user options to checker dropdown (only users with checker role)
            userMapping.filter(user => user.checker).forEach(user => {
                const option = document.createElement('option');
                option.value = user.userId;
                option.textContent = `${user.userId} - ${user.fullName}`;
                checkerSelect.appendChild(option);
            });

            // Add all users to delegate dropdowns
            userMapping.forEach(user => {
                const option = document.createElement('option');
                option.value = user.userId;
                option.textContent = `${user.userId} - ${user.fullName}`;

                [delegateSelect, bulkDelegateSelect].forEach(select => {
                    if (select) {
                        const newOption = option.cloneNode(true);
                        select.appendChild(newOption);
                    }
                });
            });
        }

        // Function to validate user roles
        async function validateUserRoles(makerId, checkerId) {
            const userMapping = await loadUserMapping();
            const maker = userMapping.find(u => u.userId === makerId);
            const checker = userMapping.find(u => u.userId === checkerId);

            if (makerId && !maker?.maker) {
                showNotification('Selected maker does not have maker role', 'error');
                return false;
            }

            if (checkerId && !checker?.checker) {
                showNotification('Selected checker does not have checker role', 'error');
                return false;
            }

            return true;
        }

        // Function to get user full name from userId
        async function getUserFullName(userId) {
            const userMapping = await loadUserMapping();
            const user = userMapping.find(u => u.userId === userId);
            return user ? user.fullName : userId;
        }

        // Function to render table rows with pagination
        async function renderReportTable() {
            console.log('Rendering table with reports:', reports);
            const tableBody = document.getElementById('reportTableBody');
            if (!tableBody) {
                console.error('Table body element not found!');
                return;
            }
            tableBody.innerHTML = '';

            // Calculate pagination
            const currentPage = parseInt(document.querySelector('.pagination-active')?.textContent || '1');
            const itemsPerPage = 10;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedReports = reports.slice(startIndex, endIndex);

            console.log('Paginated reports:', paginatedReports);

            // Update pagination info
            const totalPages = Math.ceil(reports.length / itemsPerPage);
            updatePaginationInfo(startIndex + 1, Math.min(endIndex, reports.length), reports.length, totalPages);
            updatePaginationButtons(totalPages, currentPage);

            // Load user mapping
            const userMapping = await loadUserMapping();

            // Render paginated reports
            for (const report of paginatedReports) {
                // Get user full names
                const makerUser = userMapping.find(u => u.userId === report.maker);
                const checkerUser = userMapping.find(u => u.userId === report.checker);
                const delegateUser = userMapping.find(u => u.userId === report.delegate);

                // Calculate status and MCA
                const status = calculateStatus(report.dueDate, report.submittedDate);
                const mca = calculateMCA(status);
                const urgency = getDueDateUrgency(report.dueDate);
                const deadlinesStatus = getUpcomingDeadlinesStatus(report.dueDate, report.submittedDate);
                const mappingKey = getMappingKey(report.name, report.region);
                const mappingData = window.reportsMapping[mappingKey] || {};

                console.log('Rendering report:', report.id, report.name, status, mca);

                const row = document.createElement('tr');
                row.className = 'border-b';
                row.setAttribute('data-id', report.id);

                row.innerHTML = `
    <td class="px-4 py-3 text-left">
        <div class="flex items-center">
            <input type="checkbox" class="report-checkbox w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" data-id="${report.id}">
        </div>
    </td>
    <td class="px-4 py-3 text-left">
        <div class="flex items-center space-x-2">
            <button data-id="${report.id}" class="edit-button py-2 px-3 flex items-center text-sm font-medium text-center text-white bg-primary-700 rounded-lg hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 -ml-0.5" viewbox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
                Edit
        </button>
            <button data-id="${report.id}" class="expand-preview-button py-2 px-3 flex items-center text-sm font-medium text-center text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 -ml-0.5 expand-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
                Preview
            </button>
        </div>
    </td>
    <th scope="row" class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap text-left">${report.name}</th>
    <td class="px-4 py-3 break-words text-left">
        <div class="resize-x overflow-auto min-w-[200px] max-w-full">
            ${report.coverage}
        </div>
    </td>    
    <td class="px-4 py-3 whitespace-nowrap text-left">
        <div class="flex items-center">
            ${report.timePeriod === 'Previous Month' ? 
                '<span class="bg-orange-100 text-orange-800 text-md font-medium px-2 py-0.5 rounded">Previous Month</span>' :
                report.timePeriod === 'Previous Quarter' ?
                '<span class="bg-red-100 text-red-800 text-md font-medium px-2 py-0.5 rounded">Previous Quarter</span>' :
                '<span class="bg-green-100 text-green-800 text-md font-medium px-2 py-0.5 rounded">Current</span>'
            }
        </div>
    </td>
    <td class="px-4 py-3 whitespace-nowrap text-left">
        <div class="flex items-center space-x-2">
            ${report.severity === 'Critical' ? 
                '<svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" /></svg>' :
                '<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
            }
            <span class="${report.severity === 'Critical' ? 'text-amber-600' : 'text-purple-600'} font-medium">${report.severity}</span>
        </div>
    </td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${getRegionBadge(report.region)}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.frequency}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${getStatusBadge(status)}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${formatDate(report.dueDate)}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">
        <div class="flex flex-col">
            ${(() => {
                const deadlinesStatus = getUpcomingDeadlinesStatus(report.dueDate, report.submittedDate);
                return `
                    <div class="text-md mb-1 font-medium ${deadlinesStatus.textColor}">${deadlinesStatus.status}</div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="h-2 rounded-full ${deadlinesStatus.color}" style="width: ${deadlinesStatus.percentage}%"></div>
                    </div>
                `;
            })()}
        </div>
    </td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.submittedDate ? formatDate(report.submittedDate) : '--'}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.sendDate ? formatDate(report.sendDate) : '--'}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.onDrive}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.delegate ? `${report.delegate} - ${delegateUser?.fullName || report.delegate}` : '--'}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.maker ? `${report.maker} - ${makerUser?.fullName || report.maker}` : '--'}</td>
    <td class="px-4 py-3 break-words text-left">
        <div class="resize-x overflow-auto min-w-[200px] max-w-full">
            ${report.makerNotes || '--'}
        </div>
    </td>  
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.checker ? `${report.checker} - ${checkerUser?.fullName || report.checker}` : '--'}</td>
    <td class="px-4 py-3 break-words text-left">
        <div class="resize-x overflow-auto min-w-[200px] max-w-full">
            ${report.checkerNote || '--'}
        </div>
    </td>  
    <td class="px-4 py-3 whitespace-nowrap text-left">${report.delayNotified}</td>
    <td class="px-4 py-3 whitespace-nowrap text-left">${getStatusBadge(mca)}</td>
`;

                // Add preview row
                const previewRow = document.createElement('tr');
                previewRow.className = 'preview-row hidden bg-gray-50';
                previewRow.innerHTML = `
    <td colspan="17" class="px-4 py-3">
        <div class="grid grid-cols-4 gap-6">
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Report Name</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.reportName || report.name}</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Region</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${getRegionBadge(mappingData.region || report.region)}</p>
                </div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Frequency</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.frequency || report.frequency}</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Report Recipients</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.reportRecipients ? mappingData.reportRecipients.join(', ') : '--'}</p>
                </div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Requirements</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.requirements || '--'}</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Schedule</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.schedule || '--'}</p>
                </div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Saved Location</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.savedLocation || '--'}</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Distribution List</label>
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] transition-all duration-200 hover:bg-gray-200 resize-y overflow-auto cursor-s-resize">
                    <p class="text-sm text-gray-900">${mappingData.dlList ? mappingData.dlList.join(', ') : '--'}</p>
                </div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
            <div class="space-y-2 invisible">
                <div class="bg-gray-100 rounded-lg p-3 min-h-[50px] resize-y overflow-auto"></div>
            </div>
        </div>
    </td>
`;

                tableBody.appendChild(row);
                tableBody.appendChild(previewRow);
            }

            // Attach event listeners for edit buttons
            attachEditListeners();
        }

        // Function to update pagination information
        function updatePaginationInfo(start, end, total, totalPages) {
            const paginationInfo = document.querySelector('.pagination-info');
            if (paginationInfo) {
                paginationInfo.innerHTML = `
            Page <span class="font-semibold">${start}</span> of <span class="font-semibold">${totalPages}</span>
        `;
            }

            // Update pagination buttons
            const paginationContainer = document.querySelector('.pagination-buttons');
            if (paginationContainer) {
                let paginationHTML = '';

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    const isActive = i === parseInt(document.querySelector('.pagination-active')?.textContent || '1');
                    if (i === 1 || i === totalPages || (i >= start - 1 && i <= start + 1)) {
                        paginationHTML += `
                    <li>
                        <a href="#" class="text-theme-sm hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium ${isActive ? 'bg-blue-100 text-blue-600 pagination-active' : 'text-gray-700 pagination-page'}">${i}</a>
                    </li>
                `;
                    } else if (i === start - 2 || i === start + 2) {
                        paginationHTML += `
                    <li>
                        <a href="#" class="text-theme-sm hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium text-gray-700 pagination-page">...</a>
                    </li>
                `;
                    }
                }

                paginationContainer.innerHTML = paginationHTML;
            }
        }

        // Function to handle pagination
        function handlePagination(e) {
            e.preventDefault();
            const target = e.target.closest('a, button');  // Allow both links and buttons
            if (!target) return;

            const currentPage = parseInt(document.querySelector('.pagination-active')?.textContent || '1');
            const totalPages = Math.ceil(reports.length / 10);

            let newPage = currentPage;

            if (target.classList.contains('pagination-prev') && currentPage > 1) {
                newPage = currentPage - 1;
            } else if (target.classList.contains('pagination-next') && currentPage < totalPages) {
                newPage = currentPage + 1;
            } else if (target.classList.contains('pagination-page') && !isNaN(parseInt(target.textContent))) {
                newPage = parseInt(target.textContent);
            }

            if (newPage !== currentPage) {
                // Update pagination buttons with new page
                updatePaginationButtons(totalPages, newPage);
                
                // Re-render the table with the new page
                renderReportTable();
            }
        }

        // Function to attach edit event listeners
        function attachEditListeners() {
            document.querySelectorAll('.edit-button').forEach(button => {
                button.addEventListener('click', function () {
                    const reportId = this.getAttribute('data-id');
                    openEditModal(reportId);
                });
            });

            document.querySelectorAll('.expand-preview-button').forEach(button => {
                button.addEventListener('click', function () {
                    const reportId = this.getAttribute('data-id');
                    const row = this.closest('tr');
                    const previewRow = row.nextElementSibling;
                    const icon = this.querySelector('.expand-icon');
                    
                    // Toggle preview row
                    previewRow.classList.toggle('hidden');
                    
                    // Toggle icon
                    if (previewRow.classList.contains('hidden')) {
                        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />';
                    } else {
                        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />';
                    }
                });
            });
        }

        // Function to open the edit modal and populate fields
        function openEditModal(reportId) {
            console.log('Opening edit modal for report ID:', reportId);
            const report = reportId ? reports.find(r => r.id === parseInt(reportId)) : null;
            console.log('Found report:', report);
            
            const modal = document.getElementById('editReportModal');
            const form = document.getElementById('reportForm');
            const saveButton = document.getElementById('saveButton');

            // Set the modal title and subtitle based on whether we're editing or adding
            document.getElementById('modal-title').textContent = reportId ? 'Edit Report' : 'Add Report';
            document.getElementById('modal-subtitle').textContent = reportId ? 'Edit existing report details' : 'Create a new report entry with all required details';

            // Add edit-mode class to form when editing
            if (reportId) {
                form.classList.add('edit-mode');
            } else {
                form.classList.remove('edit-mode');
            }

            // Populate dropdowns with makers
            populateDropdowns();

            // Store initial form values
            const initialValues = {};

            // Get all form fields
            const formFields = {
                reportName: document.getElementById('reportName'),
                coverage: document.getElementById('coverage'),
                severity: document.getElementById('severity'),
                region: document.getElementById('region'),
                frequency: document.getElementById('frequency'),
                dueDate: document.getElementById('dueDate'),
                submittedDate: document.getElementById('submittedDate'),
                sendDate: document.getElementById('sendDate'),
                onDrive: document.getElementById('onDrive'),
                delegate: document.getElementById('delegate'),
                maker: document.getElementById('maker'),
                makerNotes: document.getElementById('makerNotes'),
                checker: document.getElementById('checker'),
                checkerNote: document.getElementById('checkerNote'),
                delayNotified: document.getElementById('delayNotified')
            };

            // Fields to show in Add Report form
            const addFormFields = ['reportName', 'coverage', 'severity', 'region', 'frequency', 'dueDate', 'delegate', 'maker', 'checker'];

            // Set field properties based on whether we're editing or adding
            if (report) {
                console.log('Populating form with report data:', report);
                // Editing mode - show all fields and make them editable except report name
                Object.entries(formFields).forEach(([key, field]) => {
                    if (field) {
                        field.closest('.sm\\:col-span-2, div').style.display = '';
                        if (key !== 'reportName') {
                            field.removeAttribute('readonly');
                            field.classList.remove('bg-gray-100', 'cursor-not-allowed');
                        } else {
                            // For report name, keep it readonly but make it visible
                            field.classList.remove('bg-gray-100');
                            field.classList.add('bg-white');
                        }
                    }
                });

                // Populate form with report data
                Object.entries(formFields).forEach(([key, field]) => {
                    if (field) {
                        // Special handling for report name field
                        if (key === 'reportName' && report.name !== undefined) {
                            console.log('Setting report name to:', report.name);
                            field.value = report.name || '';
                        } else if (report[key] !== undefined) {
                            console.log(`Setting ${key} to:`, report[key]);
                            field.value = report[key] || '';
                        }
                    }
                });

                // Store initial values
                Object.keys(report).forEach(key => {
                    initialValues[key] = report[key];
                });

                // Set the hidden reportId field
                document.getElementById('reportId').value = report.id;
            } else {
                // Add mode - show only specific fields and make them editable
                Object.entries(formFields).forEach(([key, field]) => {
                    if (field) {
                        const fieldContainer = field.closest('.sm\\:col-span-2, div');
                        if (addFormFields.includes(key)) {
                            // Show and make editable
                            fieldContainer.style.display = '';
                            field.removeAttribute('readonly');
                            field.classList.remove('bg-gray-100', 'cursor-not-allowed');
                        } else {
                            // Hide other fields
                            fieldContainer.style.display = 'none';
                        }
                    }
                });

                // Clear the form
                form.reset();
                // Set current date for due date
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('dueDate').value = today;

                // Set the hidden reportId field to empty
                document.getElementById('reportId').value = '';
            }

            // Show the modal
            modal.style.display = 'flex';
            modal.classList.remove('hidden');

            // Add event listeners for form changes
            const formInputs = form.querySelectorAll('input:not([readonly]), select, textarea');
            formInputs.forEach(input => {
                input.addEventListener('input', () => {
                    checkFormChanges(form, initialValues, saveButton);
                });
                input.addEventListener('change', () => {
                    checkFormChanges(form, initialValues, saveButton);
                });
            });
        }

        // Function to check if form has changed
        function checkFormChanges(form, initialValues, saveButton) {
            const formData = new FormData(form);
            let hasChanges = false;

            // For new reports, enable save button if any field has a value
            if (Object.keys(initialValues).length === 0) {
                for (const [key, value] of formData.entries()) {
                    if (value && value.trim() !== '') {
                        hasChanges = true;
                        break;
                    }
                }
            } else {
                // For existing reports, check if any value has changed
                for (const [key, value] of formData.entries()) {
                    if (initialValues[key] !== value) {
                        hasChanges = true;
                        break;
                    }
                }
            }

            saveButton.disabled = !hasChanges;
        }

        // Function to calculate next due date based on frequency
        function calculateNextDueDate(currentDueDate, frequency) {
            const date = new Date(currentDueDate);
            
            switch(frequency.toLowerCase()) {
                case 'daily':
                    date.setDate(date.getDate() + 1);
                    break;
                case 'weekly':
                    date.setDate(date.getDate() + 7);
                    break;
                case 'monthly':
                    date.setMonth(date.getMonth() + 1);
                    break;
                case 'quarterly':
                    date.setMonth(date.getMonth() + 3);
                    break;
                case 'semi-monthly':
                    // Add 15 days for semi-monthly
                    date.setDate(date.getDate() + 15);
                    break;
                default:
                    return null;
            }
            
            return date.toISOString().split('T')[0];
        }

        // Function to generate new report entry
        function generateNewReportEntry(submittedReport) {
            const nextDueDate = calculateNextDueDate(submittedReport.dueDate, submittedReport.frequency);
            if (!nextDueDate) return null;

            // Create new report entry
            const newReport = {
                id: Math.max(...reports.map(r => r.id)) + 1,
                name: submittedReport.name,
                coverage: submittedReport.coverage,
                timePeriod: "Current", // Always set to Current for new reports
                severity: submittedReport.severity,
                region: submittedReport.region,
                frequency: submittedReport.frequency,
                dueDate: nextDueDate,
                submittedDate: '', // Empty as it's a new report
                maker: submittedReport.maker, // Keep the same maker
                makerNotes: '', // Empty for new report
                sendDate: '', // Empty for new report
                onDrive: 'No', // Default to No
                checker: '', // Empty for new report
                checkerNote: '', // Empty for new report
                delayNotified: 'N/A', // Default to N/A
                delegate: submittedReport.delegate // Keep the same delegate if any
            };

            return newReport;
        }

        // Function to save data to Confluence
        async function saveDataToConfluence() {
            try {
                // First, get the attachment ID for the working file
                const workingFileName = getCurrentMonthWorkingFile();
                const attachmentsResponse = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment?filename=${workingFileName}`);
                const attachmentsData = await attachmentsResponse.json();
                
                if (!attachmentsData.results || attachmentsData.results.length === 0) {
                    throw new Error('Attachment not found');
                }
                
                const attachmentId = attachmentsData.results[0].id;
                
                // Update the existing attachment
                const formData = new FormData();
                const blob = new Blob([JSON.stringify(reports, null, 2)], { type: 'application/json' });
                formData.append('file', blob, workingFileName);
                
                const response = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment/${attachmentId}`, {
                    method: 'POST',
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to save data: ${response.status} ${response.statusText}`);
                }
                
                showNotification('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Failed to save data: ' + error.message, 'error');
            }
        }

        // Function to save report to master inventory
        async function saveToMasterInventory(report) {
            try {
                // In production, this would make an API call to update the master inventory
                // Remove simulation
                return true;
            } catch (error) {
                console.error('Error saving to master inventory:', error);
                return false;
            }
        }

        // Function to save report to working file
        async function saveToWorkingFile(report) {
            try {
                // Remove simulation
                return true;
            } catch (error) {
                console.error('Error saving to working file:', error);
                return false;
            }
        }

        // Function to save the report (add or update)
        async function saveReport(formData) {
            try {
                const reportId = formData.get('reportId') ? parseInt(formData.get('reportId')) : null;
                const makerId = formData.get('maker');
                const checkerId = formData.get('checker');

                // Validate user roles
                if (!await validateUserRoles(makerId, checkerId)) {
                    return;
                }

                // Create a report object from form data
                const report = {
                    id: reportId || (Math.max(...reports.map(r => r.id)) + 1),
                    name: formData.get('reportName') || '',
                    coverage: formData.get('coverage') || '',
                    severity: formData.get('severity') || '',
                    region: formData.get('region') || '',
                    frequency: formData.get('frequency') || '',
                    dueDate: formData.get('dueDate') || '',
                    maker: makerId || '',
                    checker: checkerId || '',
                    // Set default values for other fields
                    timePeriod: 'Current',
                    submittedDate: '',
                    makerNotes: '',
                    sendDate: '',
                    onDrive: 'No',
                    checkerNote: '',
                    delayNotified: 'N/A',
                    delegate: ''
                };

                let success = true;

                // If editing an existing report
                if (reportId) {
                    const index = reports.findIndex(r => r.id === reportId);
                    if (index !== -1) {
                        const oldReport = reports[index];
                        // Preserve existing values for fields not in the form
                        report.submittedDate = oldReport.submittedDate;
                        report.makerNotes = oldReport.makerNotes;
                        report.sendDate = oldReport.sendDate;
                        report.onDrive = oldReport.onDrive;
                        report.checkerNote = oldReport.checkerNote;
                        report.delayNotified = oldReport.delayNotified;
                        report.delegate = oldReport.delegate;
                        report.timePeriod = oldReport.timePeriod;
                        
                        reports[index] = report;
                        showNotification('Report updated successfully', 'success');
                    } else {
                        showNotification('Report not found', 'error');
                        return;
                    }
                } else {
                    // Add new report
                    reports.push(report);
                    // Save new report to both master inventory and working file
                    success = await saveToMasterInventory(report) && 
                             await saveToWorkingFile(report);
                    showNotification('New report added successfully', 'success');
                }

                if (success) {
                // Save to Confluence
                    await saveDataToConfluence();

                // Re-render the table to reflect changes
                renderReportTable();

                // Close the modal
                closeModal();
                } else {
                    showNotification('Failed to save report to one or more locations', 'error');
                }
            } catch (error) {
                console.error('Error saving report:', error);
                showNotification('Failed to save report. Please try again.', 'error');
            }
        }

        // Update the form submission handler to handle async saveReport
        document.getElementById('reportForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            await saveReport(formData);
        });

        // Function to show a notification
        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            // Create and append the notification
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ?
                '<svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>' :
                '<svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';

            notification.className = `notification fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded shadow-lg z-50 animate-fade-in-out flex items-center`;
            notification.innerHTML = `${icon}${message}`;
            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Function to close the modal
        function closeModal() {
            const modal = document.getElementById('editReportModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        // Function for searching/filtering the table
        function filterTable(searchTerm) {
            const statusFilter = document.querySelector('input[name="statusFilter"]:checked').value;
            const globalChecked = document.getElementById('filterGlobal')?.checked;
            const emeaChecked = document.getElementById('filterEMEA')?.checked;
            const apacChecked = document.getElementById('filterAPAC')?.checked;
            const namChecked = document.getElementById('filterNAM')?.checked;
            const pendingChecked = document.getElementById('filterPending')?.checked;
            const onTimeChecked = document.getElementById('filterOnTime')?.checked;
            const lateChecked = document.getElementById('filterLate')?.checked;
            const criticalChecked = document.getElementById('filterCritical')?.checked;
            const nonCriticalChecked = document.getElementById('filterNonCritical')?.checked;
            const makerFilter = document.getElementById('filterMaker') ? Array.from(document.getElementById('filterMaker').selectedOptions).map(option => option.value) : [];
            const checkerFilter = document.getElementById('filterChecker') ? Array.from(document.getElementById('filterChecker').selectedOptions).map(option => option.value) : [];
            const daysFilter = document.getElementById('filterDays')?.value;

            // Filter reports based on criteria
            const filteredReports = reports.filter(report => {
                const submittedDate = report.submittedDate;
                const status = calculateStatus(report.dueDate, submittedDate);
                const dueDate = new Date(report.dueDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                // Check status filter
                let matchesStatusFilter = true;
                if (statusFilter === 'submitted') {
                    matchesStatusFilter = !!submittedDate && submittedDate !== '';
                } else if (statusFilter === 'open') {
                    matchesStatusFilter = !submittedDate || submittedDate === '';
                }

                // Check search term
                const matchesSearch = !searchTerm || 
                    report.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.coverage.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (searchTerm.toLowerCase() === 'critical' && report.severity === 'Critical') ||
                    (searchTerm.toLowerCase() === 'non-critical' && report.severity === 'Non-Critical') ||
                    report.region.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.frequency.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.maker.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.makerNotes.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.checker.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.checkerNote.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    report.delayNotified.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    formatDate(report.dueDate).toLowerCase().includes(searchTerm.toLowerCase()) ||
                    formatDate(report.submittedDate).toLowerCase().includes(searchTerm.toLowerCase()) ||
                    formatDate(report.sendDate).toLowerCase().includes(searchTerm.toLowerCase());

                // Check region filter
                const matchesRegion = !globalChecked && !emeaChecked && !apacChecked && !namChecked || 
                    (globalChecked && report.region === 'Global') ||
                    (emeaChecked && report.region === 'EMEA') ||
                    (apacChecked && report.region === 'APAC') ||
                    (namChecked && report.region === 'NAM');

                // Check status filter
                const matchesStatus = !pendingChecked && !onTimeChecked && !lateChecked ||
                    (pendingChecked && status === 'Pending') ||
                    (onTimeChecked && status === 'Submitted') ||
                    (lateChecked && status.includes('Late'));

                // Check severity filter
                const matchesSeverity = !criticalChecked && !nonCriticalChecked ||
                    (criticalChecked && report.severity === 'Critical') ||
                    (nonCriticalChecked && report.severity === 'Non-Critical');

                // Check maker filter
                const matchesMaker = makerFilter.length === 0 || 
                    makerFilter.includes(report.maker) || 
                    report.maker === '--';

                // Check checker filter
                const matchesChecker = checkerFilter.length === 0 || 
                    checkerFilter.includes(report.checker) || 
                    report.checker === '--';

                // Check days filter
                const matchesDays = !daysFilter || daysFilter.trim() === '' || 
                    (dueDate && Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24)) <= parseInt(daysFilter) && 
                    Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24)) >= 0);

                return matchesStatusFilter && matchesSearch && matchesRegion && 
                       matchesStatus && matchesSeverity && matchesMaker && matchesChecker && matchesDays;
            });

            // Update reports array with filtered results
            const originalReports = [...reports];
            reports = filteredReports;

            // Re-render the table
            renderReportTable();

            // Restore original reports array
            reports = originalReports;

            // Update pagination info
            const currentPage = parseInt(document.querySelector('.pagination-active')?.textContent || '1');
            const itemsPerPage = 10;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredReports.length);

            const paginationInfo = document.querySelector('.pagination-info');
            if (paginationInfo) {
                paginationInfo.innerHTML = `
                    Showing
                    <span class="font-semibold text-gray-900">${startIndex + 1}-${endIndex}</span>
                    of
                    <span class="font-semibold text-gray-900">${filteredReports.length}</span>
                `;
            }

            // Update pagination buttons
            const totalPages = Math.ceil(filteredReports.length / itemsPerPage);
            updatePaginationButtons(totalPages, currentPage);
        }

        // Function to update pagination buttons
        function updatePaginationButtons(totalPages, currentPage) {
            const paginationContainer = document.querySelector('.pagination-buttons');
            if (paginationContainer) {
                let paginationHTML = '';

                // Helper function to add page button
                const addPageButton = (i) => {
                    const isActive = i === currentPage;
                    return `
                        <li>
                            <a href="#" class="text-theme-sm hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium ${isActive ? 'bg-blue-100 text-blue-600 pagination-active' : 'text-gray-700 pagination-page'}">${i}</a>
                        </li>
                    `;
                };

                // Add ellipsis
                const addEllipsis = () => {
                    return `
                        <li>
                            <span class="text-theme-sm flex h-10 w-10 items-center justify-center rounded-lg font-medium text-gray-700">...</span>
                        </li>
                    `;
                };

                // Always show first page
                paginationHTML += addPageButton(1);

                if (totalPages <= 7) {
                    // If 7 or fewer pages, show all
                    for (let i = 2; i < totalPages; i++) {
                        paginationHTML += addPageButton(i);
                    }
                } else {
                    // Show pattern: 1, 2, 3, ..., (totalPages-2), (totalPages-1), totalPages
                    if (currentPage <= 3) {
                        // Near the start
                        paginationHTML += addPageButton(2);
                        paginationHTML += addPageButton(3);
                        paginationHTML += addEllipsis();
                    } else if (currentPage >= totalPages - 2) {
                        // Near the end
                        paginationHTML += addEllipsis();
                        paginationHTML += addPageButton(totalPages - 2);
                        paginationHTML += addPageButton(totalPages - 1);
                    } else {
                        // In the middle
                        paginationHTML += addEllipsis();
                        paginationHTML += addPageButton(currentPage);
                        paginationHTML += addEllipsis();
                    }
                }

                // Always show last page if more than 1 page
                if (totalPages > 1) {
                    paginationHTML += addPageButton(totalPages);
                }

                paginationContainer.innerHTML = paginationHTML;
            }

            // Update prev/next buttons
            const prevButton = document.querySelector('.pagination-prev');
            const nextButton = document.querySelector('.pagination-next');
            
            if (prevButton) {
                prevButton.disabled = currentPage === 1;
                prevButton.classList.toggle('opacity-50', currentPage === 1);
                prevButton.classList.toggle('cursor-not-allowed', currentPage === 1);
                prevButton.classList.toggle('hover:bg-gray-50', currentPage !== 1);
            }
            
            if (nextButton) {
                nextButton.disabled = currentPage === totalPages;
                nextButton.classList.toggle('opacity-50', currentPage === totalPages);
                nextButton.classList.toggle('cursor-not-allowed', currentPage === totalPages);
                nextButton.classList.toggle('hover:bg-gray-50', currentPage !== totalPages);
            }
        }

        // Function to clear all filters
        function clearAllFilters() {
            // Clear search input
            const searchInput = document.getElementById('simple-search');
            searchInput.value = '';

            // Reset status filter to Open
            document.getElementById('filterOpen').checked = true;

            // Reset severity filters
            document.getElementById('filterCritical').checked = false;
            document.getElementById('filterNonCritical').checked = false;

            // Reset region filters
            document.getElementById('filterGlobal').checked = false;
            document.getElementById('filterEMEA').checked = false;
            document.getElementById('filterAPAC').checked = false;
            document.getElementById('filterNAM').checked = false;

            // Reset status filters
            document.getElementById('filterPending').checked = false;
            document.getElementById('filterOnTime').checked = false;
            document.getElementById('filterLate').checked = false;

            // Reset maker filter
            const makerFilter = document.getElementById('filterMaker');
            if (makerFilter) {
                Array.from(makerFilter.options).forEach(option => {
                    option.selected = false;
                });
                // Clear selected makers display
                const selectedMakers = document.getElementById('selectedMakers');
                if (selectedMakers) {
                    selectedMakers.innerHTML = '';
                }
            }

            // Reset checker filter
            const checkerFilter = document.getElementById('filterChecker');
            if (checkerFilter) {
                Array.from(checkerFilter.options).forEach(option => {
                    option.selected = false;
                });
                // Clear selected checkers display
                const selectedCheckers = document.getElementById('selectedCheckers');
                if (selectedCheckers) {
                    selectedCheckers.innerHTML = '';
                }
            }

            // Reset days filter
            const daysFilter = document.getElementById('filterDays');
            if (daysFilter) {
                daysFilter.value = '';
            }

            // Reset the table to show all rows
            const tableRows = document.querySelectorAll('#reportTableBody tr');
            tableRows.forEach(row => {
                row.classList.remove('hidden');
            });

            // Apply the Open filter
            filterTable('');

            // Show success notification
            showNotification('All filters cleared successfully');
        }

        // Function to refresh the table
        function refreshTable() {
            loadDataFromConfluence();
        }

        // Function to export table data to Excel
        function exportToExcel() {
            // Get the table data
            const table = document.getElementById('reportTableBody');
            const rows = Array.from(table.querySelectorAll('tr'));

            // Prepare the data for export
            const data = rows.map(row => {
                const cells = Array.from(row.cells);
                return {
                    'Report': cells[1].textContent.trim(),
                    'Coverage': cells[2].textContent.trim(),
                    'Region': cells[3].textContent.trim(),
                    'Frequency': cells[4].textContent.trim(),
                    'Status': cells[5].textContent.trim(),
                    'Due Date': cells[6].textContent.trim(),
                    'Submitted Date': cells[7].textContent.trim(),
                    'Send Date': cells[8].textContent.trim(),
                    'On Drive': cells[9].textContent.trim(),
                    'Delegate': cells[10].textContent.trim(),
                    'Maker': cells[11].textContent.trim(),
                    'Maker Notes': cells[12].textContent.trim(),
                    'Checker': cells[13].textContent.trim(),
                    'Checker Note': cells[14].textContent.trim(),
                    'Delay Notified': cells[15].textContent.trim(),
                    'MCA': cells[16].textContent.trim()
                };
            });

            // Create a new workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(data);

            // Add the worksheet to the workbook
            XLSX.utils.book_append_sheet(wb, ws, "Reports");

            // Generate the Excel file
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });

            // Get current month and year
            const now = new Date();
            const month = now.toLocaleString('default', { month: 'long' });
            const year = now.getFullYear();

            // Create a blob and download link
            const blob = new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `EMEA_Critical_Reports_Tracker_${month}_${year}.xlsx`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            // Show success notification
            showNotification('Report exported successfully');
        }

        // Function to get the current month's working file name
        function getCurrentMonthWorkingFile() {
            const now = new Date();
            const month = now.toLocaleString('default', { month: 'long' }).toLowerCase();
            const year = now.getFullYear();
            return `reports_${month}_${year}.json`;
        }

        // Function to check if it's the first day of the month
        function isFirstDayOfMonth() {
            const now = new Date();
            return now.getDate() === 1;
        }

        // Function to copy master file to monthly working file
        async function copyMasterToWorkingFile() {
            try {
                // First, get the master file
                const masterResponse = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/critical-reports-inventory.json?api=v2');
                if (!masterResponse.ok) {
                    throw new Error('Failed to load master file');
                }
                const masterData = await masterResponse.json();

                // Create a new working file for the current month
                const workingFileName = getCurrentMonthWorkingFile();
                const formData = new FormData();
                const blob = new Blob([JSON.stringify(masterData, null, 2)], { type: 'application/json' });
                formData.append('file', blob, workingFileName);

                // Upload the new working file
                const uploadResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment', {
                    method: 'POST',
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    },
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error('Failed to create working file');
                }

                console.log('Successfully created new monthly working file');
                return true;
            } catch (error) {
                console.error('Error copying master file:', error);
                return false;
            }
        }

        // Function to load data from Confluence attachment
        async function loadDataFromConfluence() {
            try {
                // Only load from Confluence
                const workingFileName = getCurrentMonthWorkingFile();
                const response = await fetch(`https://cedt-confluence.net/confluence/download/attachments/2740868871/${workingFileName}?api=v2`);
                if (!response.ok) {
                    throw new Error(`Failed to load data: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                reports = data;
                renderReportTable();
                filterTable('');
                showNotification('Data loaded successfully');
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Failed to load data: ' + error.message, 'error');
            }
        }

        // Function to open the preview modal
        function openPreviewModal(reportId) {
            const report = reports.find(r => r.id == reportId);
            if (!report) return;

            const modal = document.createElement('div');
            modal.id = 'previewModal';
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            
            const status = calculateStatus(report.dueDate, report.submittedDate);
            const mca = calculateMCA(status);
            const deadlinesStatus = getUpcomingDeadlinesStatus(report.dueDate, report.submittedDate);

            modal.innerHTML = `
                <div class="relative top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-md bg-white">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Report Preview</h3>
                        <button class="close-preview text-gray-400 hover:text-gray-500">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Report Name</label>
                                <p class="mt-1 text-sm text-gray-900">${report.name}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Coverage</label>
                                <p class="mt-1 text-sm text-gray-900">${report.coverage}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Region</label>
                                <p class="mt-1 text-sm text-gray-900">${getRegionBadge(report.region)}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Frequency</label>
                                <p class="mt-1 text-sm text-gray-900">${report.frequency}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Status</label>
                                <p class="mt-1 text-sm text-gray-900">${getStatusBadge(status)}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Due Date</label>
                                <p class="mt-1 text-sm text-gray-900">${formatDate(report.dueDate)}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Upcoming Deadlines</label>
                                <p class="mt-1 text-sm text-gray-900">
                                    <div class="text-md mb-1 font-medium ${deadlinesStatus.textColor}">${deadlinesStatus.status}</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full ${deadlinesStatus.color}" style="width: ${deadlinesStatus.percentage}%"></div>
                                    </div>
                                </p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Submitted Date</label>
                                <p class="mt-1 text-sm text-gray-900">${report.submittedDate ? formatDate(report.submittedDate) : '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Maker</label>
                                <p class="mt-1 text-sm text-gray-900">${report.maker}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Maker Notes</label>
                                <p class="mt-1 text-sm text-gray-900">${report.makerNotes || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Send Date</label>
                                <p class="mt-1 text-sm text-gray-900">${report.sendDate ? formatDate(report.sendDate) : '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">On Drive</label>
                                <p class="mt-1 text-sm text-gray-900">${report.onDrive}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Checker</label>
                                <p class="mt-1 text-sm text-gray-900">${report.checker || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Checker Note</label>
                                <p class="mt-1 text-sm text-gray-900">${report.checkerNote || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Delay Notified</label>
                                <p class="mt-1 text-sm text-gray-900">${report.delayNotified}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Delegate</label>
                                <p class="mt-1 text-sm text-gray-900">${report.delegate ? `${report.delegate} - ${delegateUser?.fullName || report.delegate}` : '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Maker</label>
                                <p class="mt-1 text-sm text-gray-900">${report.maker}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Maker Notes</label>
                                <p class="mt-1 text-sm text-gray-900">${report.makerNotes || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Send Date</label>
                                <p class="mt-1 text-sm text-gray-900">${report.sendDate ? formatDate(report.sendDate) : '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">On Drive</label>
                                <p class="mt-1 text-sm text-gray-900">${report.onDrive}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Checker</label>
                                <p class="mt-1 text-sm text-gray-900">${report.checker || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Checker Note</label>
                                <p class="mt-1 text-sm text-gray-900">${report.checkerNote || '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Delay Notified</label>
                                <p class="mt-1 text-sm text-gray-900">${report.delayNotified}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Delegate</label>
                                <p class="mt-1 text-sm text-gray-900">${report.delegate ? `${report.delegate} - ${delegateUser?.fullName || report.delegate}` : '--'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">MCA</label>
                                <p class="mt-1 text-sm text-gray-900">${getStatusBadge(mca)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Add event listener for close button
            modal.querySelector('.close-preview').addEventListener('click', () => {
                modal.remove();
            });

            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Function to get unique makers from reports
        function getUniqueMakers() {
            const makers = new Set();
            reports.forEach(report => {
                if (report.maker && report.maker.trim() !== '') {
                    makers.add(report.maker);
                }
            });
            return Array.from(makers).sort();
        }

        // Function to open the bulk relog modal
        function openBulkRelogModal() {
            const selectedReports = getSelectedReports();
            if (selectedReports.length === 0) {
                showNotification('Please select at least one report to delegate', 'error');
                return;
            }

            const modal = document.getElementById('bulkRelogModal');
            const newMakerSelect = document.getElementById('bulkNewMaker');

            // Populate dropdowns with makers
            populateDropdowns();

            // Show the modal
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
        }

        // Function to close the bulk relog modal
        function closeBulkRelogModal() {
            const modal = document.getElementById('bulkRelogModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        // Function to get selected reports
        function getSelectedReports() {
            const checkboxes = document.querySelectorAll('.report-checkbox:checked');
            return Array.from(checkboxes).map(checkbox => parseInt(checkbox.getAttribute('data-id')));
        }

        // Function to handle bulk relog submission
        function handleBulkRelog(formData) {
            try {
                const newMaker = formData.get('bulkNewMaker');
                const selectedReportIds = getSelectedReports();

                // Update all selected reports
                selectedReportIds.forEach(reportId => {
                    const reportIndex = reports.findIndex(r => r.id === reportId);
                    if (reportIndex !== -1) {
                        reports[reportIndex].delegate = newMaker; // Update delegate instead of maker
                    }
                });
                
                // Save to Confluence
                saveDataToConfluence();
                
                // Re-render the table
                renderReportTable();
                
                // Close the modal
                closeBulkRelogModal();
                
                // Show success notification
                showNotification(`Successfully delegated ${selectedReportIds.length} reports to ${newMaker}`);
            } catch (error) {
                console.error('Error bulk delegating reports:', error);
                showNotification('Failed to delegate reports. Please try again.', 'error');
            }
        }

        // Add all event listeners once the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Set Open as default filter
            document.getElementById('filterOpen').checked = true;
            
            // Load initial data from Confluence
            loadDataFromConfluence();

            // Add event listener for status filter radio buttons
            document.querySelectorAll('input[name="statusFilter"]').forEach(radio => {
                radio.addEventListener('change', function() {
                filterTable(document.getElementById('simple-search').value);
                });
            });

            // Add event listeners for filter checkboxes
            ['filterGlobal', 'filterEMEA', 'filterAPAC', 'filterNAM', 'filterPending', 'filterOnTime', 'filterLate', 'filterCritical', 'filterNonCritical'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                filterTable(document.getElementById('simple-search').value);
                    });
                }
            });

            // Add event listener for days filter
            const daysFilter = document.getElementById('filterDays');
            if (daysFilter) {
                daysFilter.addEventListener('input', function() {
                filterTable(document.getElementById('simple-search').value);
            });
            }

            // Add event listeners for maker and checker filters
            ['filterMaker', 'filterChecker'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                filterTable(document.getElementById('simple-search').value);
            });
                }
            });

            // Add event listener for the filter dropdown button
            document.getElementById('filterDropdownButton').addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = document.getElementById('filterDropdown');
                if (dropdown) {
                    dropdown.classList.toggle('hidden');
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('filterDropdown');
                const button = document.getElementById('filterDropdownButton');
                if (dropdown && !dropdown.contains(e.target) && !button.contains(e.target)) {
                        dropdown.classList.add('hidden');
                }
            });

            // Add event listener for the 'Add Report' button
            document.getElementById('addReportBtn').addEventListener('click', function () {
                openEditModal(null); // null indicates we're adding a new report
            });

            // Add form submission handler
            document.getElementById('reportForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                saveReport(formData);
            });

            // Add close modal handlers
            document.querySelectorAll('#closeModal').forEach(button => {
                button.addEventListener('click', closeModal);
            });

            // Close modal when clicking outside the form area
            document.getElementById('editReportModal').addEventListener('click', function (e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Add search functionality
            document.getElementById('simple-search').addEventListener('input', function () {
                filterTable(this.value);
            });

            // Add refresh table button listener
            document.getElementById('refreshTableBtn').addEventListener('click', refreshTable);

            // Add clear filters button listener
            document.getElementById('clearFiltersBtn').addEventListener('click', clearAllFilters);

            // Add export button listener
            document.querySelector('button:has(svg[viewbox="0 0 24 24"][stroke-width="2"])').addEventListener('click', exportToExcel);

            // Add pagination event listeners
            const paginationContainer = document.querySelector('.flex-1.flex.justify-center');
            if (paginationContainer) {
                // Event listener for page numbers
                paginationContainer.addEventListener('click', handlePagination);
            }

            // Add event listeners for prev/next buttons
            const prevButton = document.querySelector('.pagination-prev');
            const nextButton = document.querySelector('.pagination-next');

            if (prevButton) {
                prevButton.addEventListener('click', handlePagination);
            }
            if (nextButton) {
                nextButton.addEventListener('click', handlePagination);
            }

            // Add bulk relog button handler
            document.getElementById('bulkRelogBtn').addEventListener('click', openBulkRelogModal);

            // Add bulk relog form submission handler
            document.getElementById('bulkRelogForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                handleBulkRelog(formData);
            });

            // Add close bulk relog modal handlers
            document.getElementById('closeBulkRelogModal').addEventListener('click', closeBulkRelogModal);
            document.getElementById('cancelBulkRelogModal').addEventListener('click', closeBulkRelogModal);

            // Close bulk relog modal when clicking outside
            document.getElementById('bulkRelogModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeBulkRelogModal();
                }
            });

            // Add select all checkbox handler
            document.getElementById('selectAll').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.report-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });

            // Add click event listeners to edit buttons
            document.querySelectorAll('.edit-button').forEach(button => {
                button.addEventListener('click', () => {
                    const reportId = button.getAttribute('data-report-id');
                    console.log('Edit button clicked for report ID:', reportId);
                    openEditModal(reportId);
                });
            });
        });

        function openAddModal() {
            const modal = document.getElementById('editReportModal');
            const form = document.getElementById('reportForm');
            const saveButton = document.getElementById('saveButton');

            // Reset form
            form.reset();
            form.classList.remove('edit-mode');
            document.getElementById('reportId').value = '';
            document.getElementById('modal-title').textContent = 'Add Report';
            document.getElementById('modal-subtitle').textContent = 'Create a new report entry with all required details';
        }

        // Bulk delegate button click handler
        document.getElementById('bulkRelogBtn').addEventListener('click', function() {
            const selectedReports = getSelectedReports();
            if (selectedReports.length === 0) {
                showNotification('Please select at least one report to delegate', 'error');
                return;
            }
            openBulkRelogModal(selectedReports);
        });
    </script>
</body>

</html>
